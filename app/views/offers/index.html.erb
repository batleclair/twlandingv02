<% content_for :title, "Trouvez la mission de m√©c√©nat de comp√©tences qui vous correspond" %>
<% content_for :description, "Gr√¢ce √† Demain, trouvez l'association qui a besoin de vos comp√©tences et qui vous correspond ! Demain propose des missions de m√©c√©nat de comp√©tences et vous permet de vous engager sur votre temps de travail en vous aidant √† obtenir le soutien de votre entreprise." %>
<% canonical(offers_url) %>

<div class="ctn-resp white-bg p-5">
  <h1 class="d-none">Trouvez la mission de m√©c√©nat de comp√©tences qui vous correspond</h1>
  <h2 class="center-text primary-text-color mb-2 mt-5">Les missions de <span class="stress">Demain</strong></h2>
  <p class="mb-4 primary-text-color center-text">plus besoin de choisir entre sa carri√®re et ses valeurs ! Demain permet de combiner son job actuel avec un second d'int√©r√™t g√©n√©ral</p>
</div>

<div data-controller="search-form">
  <div class="filter-ctn">

    <div class="indication indication-right" data-search-form-target="indication">
      <p class="primary-text-color sm-thin-text"><i class="fa-solid fa-arrow-down-long"></i>masquer les filtres</p>
    </div>
    <div class="indication indication-left d-none" data-search-form-target="indication">
      <p class="primary-text-color sm-thin-text"><i class="fa-solid fa-arrow-down-long"></i>voir les filtres üòã</p>
    </div>
    <i class="fa-solid fa-magnifying-glass filter-icon filter-icon-active" data-search-form-target="btn" data-action="click->search-form#toggle">
      <div data-search-form-target="counter" class="d-none"></div>
    </i>

    <div data-search-form-target="filters" class="filters filters-expand">
      <%= form_tag offers_path, method: :get, data: { search_form_target: 'form', action: 'change->search-form#result' } do %>
        <div class="flex-resp justify-content-center mt-4">
          <div class="pill-ctn round-shadow-box p-4 m-3">
            <div class="d-flex full-width justify-content-between align-items-center mb-2" data-controller="legend">
              <h5 class="primary-text-color">Engagement requis</h5>
              <button class="round-button-sm btn-main-color" data-action="click->legend#popup">?</button>
              <%= render partial: "offers/legend" %>
            </div>
            <%= check_box_tag :low, 1, params[:low], hidden: true %>
            <%= label_tag :low, 'üëç light', class: "mb-1" %>
            <%= check_box_tag :mid, 1, params[:mid], hidden: true %>
            <%= label_tag :mid, 'üëè moyen', class: "mb-1" %>
            <%= check_box_tag :high, 1, params[:high], hidden: true %>
            <%= label_tag :high, 'üôå costaud', class: "mb-1" %>
          </div>

          <div class="pill-ctn round-shadow-box p-4 m-3">
            <h5 class="mb-2 primary-text-color">Mission de l'association</h5>
            <%= check_box_tag :social, 1, params[:social], hidden: true %>
            <%= label_tag :social, 'ü§ùüèª Sociale', class: "mb-1" %>
            <%= check_box_tag :environment, 1, params[:environment], hidden: true %>
            <%= label_tag :environment, 'üåç Environnementale', class: "mb-1" %>
          </div>

          <div class="round-shadow-box p-4 m-3">
            <h5 class="mb-2 primary-text-color">M√©tiers</h5>
            <%= select_tag :function, options_for_select(Offer::FUNCTIONS, params[:function]), include_blank: "Tous", class: 'pill-dropdown', data: { search_form_target: 'select'}, selected: params[:function] %>
          </div>

          <%= number_field_tag 'id', @params[:id], hidden: true, data: { search_form_target: 'id' } %>
          <%= submit_tag "", hidden: "true", data: { search_form_target: 'submitbtn' } %>
        </div>
        <% end %>
    </div>

  </div>

  <div class="ctn-resp white-bg pt-5 pb-5">

    <div class="flex-resp early-resp-1000" data-controller="candidacy">
      <div class="half-width-resp early-resp-1000 mg-resp-r">
        <p><span class="single-pill me-2 bold-6"><%= @offers.count %></span>missions disponibles</p>
        <% @offers.each do |offer| %>
          <%= link_to offers_path(@params.merge!(id: offer.id)), data: {"search-form-target": "card", active: params[:id].to_s == offer.id.to_s, id: offer.id, action: "click->search-form#preview", destination: (offer.active? ? offer_path(offer) : '')}, class:"flat-card-bg" do %>
            <div class="p-3 d-flex mt-2 mb-2 pe-none">
              <div class="logo-box square-sm flex-shrink-0">
                <%= offer.beneficiary.logo.attached? && offer.active? ? cl_image_tag(offer.beneficiary.logo.key) : cl_image_tag('../default_logo.png') %>
              </div>
              <div class="ps-3 flat-card-text full-width">
                <div class="d-flex justify-content-between full-width">
                  <h5><%= offer.title %></h5>
                  <% if offer.active? %>
                    <h5 class="primary-text-color bold-7 when-active">+</h5>
                  <% end %>
                </div>
                <p class="primary-text-color">üíú <%= offer.beneficiary.cause %></p>
                <div class="flex-resp">
                  <p><%= offer.commitment_output %></p>
                  <p class="mg-resp-l">üìç <%= offer.location %></p>
                </div>
              </div>
            </div>
          <% end %>
        <% end %>

        <div class="job-card-dark mt-2 mb-2">
          <h3 class="center-text">+</h3>
          <h5 class="center-text no-wrap">La mission pour vous</h5>
          <%= link_to offers_path(@params.merge!(id: @no_offer.id)), data: {"search-form-target": "card", active: params[:id].to_s == @no_offer.id.to_s, id: @no_offer.id, action: "click->search-form#preview", destination: ''}, class: "d-flex flex-column justify-content-center align-items-center p-2" do %>
            <h6 class="white-text center-text mb-2">Aucune mission ne vous correspond ? Laissez-nous trouver pour vous !</h6>
          <% end %>
        </div>
      </div>

      <div class="loader-frame mobile-only-loader early-resp-1000" style="display: none;" data-search-form-target="loader">
        <div class="round-button btn-round-cta">
          <span class="round-button loader"></span>
        </div>
      </div>

      <div class="half-width-resp early-resp-1000 mg-resp-l offer-preview-ctn mb-2" data-search-form-target="preview" data-active=<%= params[:id].present? ? "true" : "false" %>>
        <%= render partial: "offers/preview", locals: {offer: @offer} %>
      </div>

      <span data-candidacy-target="content"><%= render partial: "offers/candidacy", locals: {offer: @no_offer, candidacy: @candidacy} %></span>

    </div>

    <div class=" mt-5 pt-5 pb-5 white-bg" data-controller="contact">
      <div class="white-bg d-flex justify-content-center">
        <%= link_to '', class: "fat-btn fat-btn-main-color position-relative d-flex justify-content-between align-items-center", data: {action: "click->contact#popup"} do %>
          <span></span>
          <strong>Des questions ?</strong>
          <i class="fa-solid fa-phone round-button white-bg"></i>
        <% end %>
      </div>
      <%= render partial: "pages/contact" %>
    </div>
  </div>
</div>
