<% bg_img = @offer.beneficiary.photo.attached? ? cl_image_path(@offer.beneficiary.photo.key) : image_path('bannerbg.jpg') %>
<% b_logo = @offer.beneficiary.logo.attached? ? cl_image_tag(@offer.beneficiary.logo.key) : image_tag('illustration5.png') %>

<div style="background-image: linear-gradient(45deg, rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.6)), url('<%= bg_img %>')" class="offer-banner">
  <div class="logo-box mb-3">
    <%= b_logo %>
  </div>
  <h2><%= @offer.title %></h2>
  <div class="offer-specs">
    <ul class="list-inline">
      <li>ğŸ“ Lieu : <%= @offer.location %></li>

      <% case
      when @offer.half_days_min.nil? && @offer.half_days_max.nil?
        f = "Ã  dÃ©finir"
      when  ( @offer.half_days_min.nil? && !@offer.half_days_max.nil? ) || @offer.half_days_min == @offer.half_days_max
        f = "#{@offer.half_days_max.fdiv(2).round(1).to_s.chomp('.0')} j / sem"
      when  ( !@offer.half_days_min.nil? && @offer.half_days_max.nil? )
        f = "#{@offer.half_days_min.fdiv(2).round(1).to_s.chomp('.0')} j / sem"
      else
        f = "#{@offer.half_days_min.fdiv(2).round(1).to_s.chomp('.0')} Ã  #{@offer.half_days_max.fdiv(2).round(1).to_s.chomp('.0')} j / sem"
      end %>

      <li class="ps-3 pe-3">ğŸ• FrÃ©quence : <%= f %></li>

      <% case
      when @offer.months_min.nil? && @offer.months_max.nil?
        d = "Ã  dÃ©finir"
      when  ( @offer.months_min.nil? && !@offer.months_max.nil? ) || @offer.months_min == @offer.months_max
        d = "#{@offer.months_max} mois"
      when  ( !@offer.months_min.nil? && @offer.months_max.nil? )
        d = "#{@offer.months_min} mois"
      else
        d = "#{@offer.months_min} Ã  #{@offer.months_max} mois"
      end %>

      <li>ğŸ“… DurÃ©e : <%= d %></li>
    </ul>
  </div>
</div>


<div class="white-wrapper">
  <div class="d-flex">
    <div>
      <h4 class="mb-4"><span class="stress"><%= @offer.title %></span></h4>
      <%= @offer.description %>
    </div>
    <div class="fixed-size-box ms-5 sticky-cta" data-controller="lock">
      <% action = user_signed_in? ? "click->modal#popup" : "click->lock#unhide" %>
      <% if user_signed_in? %>
        <% if @offer.candidates.where(user_id: current_user.id).none? %>
          <button class="button full-width btn-flag-color mb-3" data-action=<%= action %> data-lock-target="apply">Candidater !</button>
          <h5 class="text-center primary-text-color">Un impact limitÃ© sur votre rÃ©munÃ©ration !</h5>
        <% else %>
          <h5 class="text-center primary-text-color mb-4">Votre candidature a bien Ã©tÃ© prise en compte ğŸ™Œ</h5>
        <% end %>
      <% else %>
        <button class="button full-width btn-flag-color mb-3" data-action=<%= action %> data-lock-target="apply">Candidater !</button>
        <div class="d-none" data-lock-target="login">
          <div class="d-flex">
            <%= link_to "Connexion", new_user_session_path, class: "button full-width btn-main-color mb-3 me-2"%>
            <%= link_to "Inscription",  new_user_registration_path, class: "button full-width btn-light-main mb-3 ms-2"%>
          </div>
        </div>
      <% end %>
      <h6 class="mt-3">GrÃ¢ce Ã  Demain :</h6>
      <p>Votre rÃ©munÃ©ration sera <span class="stress">au moins Ã©quivalente au cumul de 2 temps partiels</span>, l'un dans votre entreprise et l'autre chez <strong><%= @offer.beneficiary.name %></strong></p>
      <%= link_to "En savoir +", candidates_path, class: "button full-width btn-main-color mt-3" %>
    </div>
  </div>
  <% if user_signed_in? && policy(Offer).edit? %>
    <%= link_to "Modifier l'offre", edit_offer_path(@offer), class: "button" %>
  <% end %>
</div>

<%= render partial: "candidacy", locals: {offer: @offer, candidacy: @candidacy} %>
