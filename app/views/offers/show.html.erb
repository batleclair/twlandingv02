<% content_for :title, "#{@offer.title} pour l'association #{@offer.beneficiary.name}" %>
<% content_for :description, "Grâce à Demain, engagez-vous auprès de l'association #{@offer.beneficiary.name} dans le cadre d'un mécénat de compétences. La mission : #{@offer.title}. L'objectif de l'association : #{@offer.beneficiary.cause}" %>
<% canonical(offer_url(@offer)) %>

<% if @offer.beneficiary.photo.attached? %>
  <% content_for :image, cl_image_path(@offer.beneficiary.photo.key, transformation: {background: "#531cb3", width: 1200, height: 630, crop: :fill, effect: "gradient_fade:symmetric:5"}, overlay: "logo_white.png", width: 500, crop: :scale) %>
<% end %>
<% b_logo_path = @offer.beneficiary.logo.attached? ? cl_image_path(@offer.beneficiary.logo.key) : image_path('heart_globe.png') %>
<% content_for :structured_data, @offer.structured_data(b_logo_path).to_json.html_safe %>

<% bg_img = @offer.beneficiary.photo.attached? ? cl_image_path(@offer.beneficiary.photo.key) : image_path('bannerbg.jpg') %>
<% b_logo = @offer.beneficiary.logo.attached? ? cl_image_tag(@offer.beneficiary.logo.key, alt:"logo de l'association #{@offer.beneficiary.name}") : image_tag('illustration5.png', alt: "logo d'association") %>

<h1 class="d-none">Mécénat de compétences : travailler pour l'association <%= @offer.beneficiary.name %> (<%= @offer.title %>)</h1>
<div class="position-relative">
  <div style="background-image: linear-gradient(45deg, rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.6)), url('<%= bg_img %>')" class="offer-banner">
    <div class="logo-box mb-3">
      <%= b_logo %>
    </div>
    <h2><%= @offer.title %></h2>
    <div class="offer-specs flex-resp">
      <p class="white-text ms-2 me-2">📍 <%= @offer.location %></p>
      <p class="white-text ms-2 me-2">💜 <%= @offer.beneficiary.cause %></p>
      <p class="white-text ms-2 me-2 d-flex align-items-center info-bubble"><%= @offer.commitment_output %>
        <strong>?</strong>
        <% if @offer.commitment.present? %>
          <% case %>
          <% when @offer.commitment.start_with?('👍') %>
            <span>nécessite une implication limitée à quelques jours</span>
          <% when @offer.commitment.start_with?('👏') %>
            <span>nécessite une implication soutenue, par exemple 1j/sem pendant plusieurs mois</span>
          <% when @offer.commitment.start_with?('🙌') %>
            <span>nécessite une implication durable, par exemple 1 à 2 j/sem pendant 1 an ou +</span>
          <% end %>
        <% end %>
      </p>
    </div>
  </div>


  <div class="offer-flex-resp white-bg" data-controller="candidacy">

    <div class="mobile-sticky-ctn">
      <%= render partial: "apply", locals: {offer: @offer} %>
    </div>

    <div>
      <div class="ctn-resp resp-lhs-padding pb-4 position-relative">
        <div class="flex-resp align-items-center title mt-3">
          <h4><span class="stress"><%= @offer.title %></span></h4>
          <h4 class="ms-3 me-3 title-separator">|</h4>
          <h5><em><%= @offer.beneficiary.name %></em></h5>
        </div>
      </div>

      <div class="ctn-resp resp-lhs-padding shaded-bg pt-5 pb-5 mb-3 d-flex">
        <div class="rt-bullet-list-heart">
          <h5 class="primary-text-color mb-2">2-3 bonnes raisons de s'engager :</h5>
          <%= @offer.summary %>
        </div>
      </div>

      <div class="ctn-resp resp-lhs-padding white-bg pt-3 pb-3">
        <div class="flex-resp beneficiary-card">
          <div class="lhs-beneficiary-card">
            <div class="logo-box downsize90 subtle-shadow mb-4">
              <%= b_logo %>
            </div>
            <div class="d-flex justify-content-center full-width">

              <% if @offer.beneficiary.li_url.present? %>
                <%= link_to @offer.beneficiary.web_url, target: "_blank" do %>
                  <i class="fa-solid fa-globe round-button btn-round-cta me-3"><span class="cta-top-legend sm-thin-text primary-text-color no-wrap">web</span></i>
                <% end %>
              <% else %>
                <i class="fa-solid fa-globe round-button btn-round-cta inactive me-3"><span class="cta-top-legend sm-thin-text primary-text-color no-wrap">web</span></i>
              <% end %>

              <% if @offer.beneficiary.li_url.present? %>
                <%= link_to @offer.beneficiary.li_url, target: "_blank" do %>
                  <i class="fa-brands fa-linkedin-in round-button btn-round-cta"><span class="cta-top-legend sm-thin-text primary-text-color">linkedin</span></i>
                <% end %>
              <% else %>
                <i class="fa-brands fa-linkedin-in round-button btn-round-cta inactive"><span class="cta-top-legend sm-thin-text primary-text-color">linkedin</span></i>
              <% end %>

            </div>
            <div class="center-text mt-4">
              <h6 class="primary-text-color">📍 Siège :</h6>
              <p class="mb-2"><%= @offer.beneficiary.city %></p>
              <h6 class="primary-text-color"><%= @offer.beneficiary.goal == 'Environnement' ? '🌍' : '🤝🏻' %> Cause :</h6>
              <p><%= @offer.beneficiary.cause %></p>
            </div>

          </div>
          <div>
            <h5 class="primary-text-color mb-2">Un mot de l'asso :</h5>
            <%= @offer.beneficiary.description %>
          </div>
        </div>
      </div>

      <div class="ctn-resp resp-lhs-padding pt-3 pb-3">
        <div class="grey-bg p-3 rt-bullet-list-arrow rt-color-text-style">
          <h5 class="primary-text-color mb-2">La mission concrètement :</h5>
          <%= @offer.description %>
        </div>
      </div>
    </div>

    <div class="sticky-placeholder align-self-stretch">
      <div class="mt-5 mb-5"></div>
      <div class="sticky-box">
        <%= render partial: "apply", locals: {offer: @offer} %>
        <div class="mt-3">
          <h6 class="primary-text-color mb-2">Engagement minimal :</h6>
          <h6 class="mb-1">⏲️ Fréquence : <%= @offer.frequency_output %></h6>
          <h6>📅 Durée : <%= @offer.duration_output %></h6>
          <p class="mt-3 mb-3">Demain t'accompagne auprès de ton entreprise pour pouvoir t'engager sur ton temps de travail</p>
          <div class="d-flex full-width justify-content-end">
            <%= link_to "en savoir +", candidates_path, class: "button-round btn-light-main" %>
          </div>
        </div>
      </div>
    </div>
    <%= render partial: "candidacy", locals: {offer: @offer, candidacy: @candidacy} %>
  </div>
</div>
