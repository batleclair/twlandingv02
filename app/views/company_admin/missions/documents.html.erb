<div class="mb-20">
  <%= render partial: "tabs" %>
</div>

<div class="d-flex">
  <%= render partial: "list" %>

  <div class="ml-40 mb-40 w-100 max-w-500">
    <div class="mb-20">
      <%= render partial: "subtabs" %>

      <%= simple_form_for(@mission, url: company_admin_mission_path(@mission), html: {data: {controller: "hidden-form", hidden_form_target: "form"}}) do |f| %>
        <div class="flex-center-between mb-20">
          <h5 class="w-100 fw-6 text-main">Documents</h5>
          <%= link_to "", data: {action: "click->hidden-form#edit", hidden_form_target: "output"} do %>
            <i class="downsize70 fa-solid fa-plus round-button btn-round-cta"></i>
          <% end %>
          <%= link_to "", data: {action: "click->hidden-form#cancel", hidden_form_target: "input"}, class: "d-none" do %>
            <i class="downsize70 fa-solid fa-xmark round-button btn-round-cta"></i>
          <% end %>
        </div>
        <% if @mission.contracts.empty? %>
          <p>Cette mission n'a aucun document associé. <%= link_to "Ajouter", "", class:"fw-7 text-main", data: {action: "click->hidden-form#edit", hidden_form_target: "output"} %></p>
        <% end %>
        <div data-hidden-form-target="input" class="d-none">
          <%= f.simple_fields_for :contracts, @contract do |c| %>
            <%= c.input :title, label: "Titre", wrapper_html: {class: "position-relative"} %>
            <%= c.input :contract_type, collection: Contract.contract_types.keys, label: "Type", wrapper_html: {class: "position-relative"} %>
            <%= c.input :document, as: :file, label: "Document", wrapper_html: {class: "position-relative"} %>
          <% end %>
          <button type="submit", class="w-100 button round bg-white-to-shade first-main-border text-main bn-none d-none" data-hidden-form-target="input">
            <i class="fa-solid fa-floppy-disk mr-10"></i>
            Enregistrer le document
          </button>
        </div>
      <% end %>
    </div>

    <div>
      <% @mission.contracts.each do |contract| %>
        <div class="w-100 bg-light flex-center-between p-20 mb-10">
          <div>
            <h6><%= contract.title %></h6>
            <p class=""><%= contract.contract_type %></p>
          </div>
          <div class="d-flex">
            <%= link_to cl_image_path(contract.document.key), target: "_blank", class:"text-main" do %>
              <i class="fa-regular fa-circle-down mr-10"></i>
            <% end %>
            <%= link_to company_admin_contract_path(contract, view: params[:view]), data: {turbo_method: :delete, turbo_confirm: "Sûr.e de vouloir supprimer ??"} do %>
              <i class="fa-solid fa-trash text-main"></i>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>
