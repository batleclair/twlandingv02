<div class="mb-20">
  <%= render partial: "tabs", locals: {candidacy: @candidacy_on_record} %>
</div>

<div class="d-flex">
  <%= render partial: "summary" %>
  <div class="ml-40 w-100 max-w-500">
    <div class="w-100">
      <div class="mb-20">
        <h5 class="text-main">Demande de Mission</h5>
        <p>Date de démarrage envisagée : <%= @candidacy.req_start_date %></p>
        <p>Estimation du nombre de jours requis : <%= @candidacy.req_days %> jours</p>
        <p>Périodicité envisagée : <%= @candidacy.req_periodicity %></p>
        <p>Contenu de la mission : <%= @candidacy.req_description %></p>
      </div>

      <% if @candidacy_on_record.active %>

        <% case @candidacy_on_record.status %>
        <% when "user_validation" %>
          <div class="max-w-300">
            <%= simple_form_for(@candidacy, url: company_admin_candidacy_path(@candidacy), action: :update, data: {turbo: false}) do |f| %>
              <div class="position-relative mb-20">
                <%= f.input :manager_validation, as: :boolean, label: "Validée par le manager", input_html: {class: "toggle"}, wraper: false %>
              </div>
              <div class="xl-radio-btns position-relative">
                <%= f.collection_radio_buttons :status, [["valider", "mission"], ["refuser", "admin_validation"]], :last, :first do |b|
                  b.radio_button(class: (b.value == "mission" ? 'flag-3-radio' : 'flag-2-radio' ))  + b.label
                end %>
                <%= f.error :status, class: "invalid-msg" %>
              </div>
              <%= f.input :admin_validation_date, as: :hidden, input_html: {value: Date.today} %>
              <%= f.input :active, as: :hidden, input_html: {value: false} %>
              <%= f.simple_fields_for :comments, @comment do |c| %>
                <%= c.input :content, label: "Message", wrapper_html: {class: "position-relative"} %>
              <% end %>
              <button type="submit" class="btn-main-color round-10 text-white square-40 w-100 flex-center">
                <i class="fa-regular fa-paper-plane mr-10"></i>
                Envoyer ma réponse
              </button>
            <% end %>
          </div>
        <% when "mission" %>
          <div class="mb-40">
            <h6>Cette mission a été validée !</h6>
            <p class="mb-20">Message : <%= @candidacy.admin_validation_message %></p>
            <h6 class="mb-10">Retrouvez les informations relatives à la mission ici :</h6>
            <% if @candidacy.mission.present? %>
              <%= link_to "Editer", company_admin_mission_path(@candidacy.mission), class:"button btn-main-color" %>
            <% else %>
              <%= link_to "Créer", new_company_admin_candidacy_mission_path(@candidacy), class:"button btn-main-color" %>
            <% end %>
          </div>
        <% end %>

      <% else %>
        <div class="mb-40">
          <h6>Cette mission a été refusée à votre salarié pour la raison suivante :</h6>
          <p><%= @candidacy_on_record.current_comment.content if @candidacy_on_record.current_comment.present? %></p>
        </div>
        <p>Veuillez nous contacter si vous souhaitez réévaluer la demande</p>
      <% end %>
    </div>
  </div>
</div>

<div class="pl-40 w-100">



</div>
